import{r as e,e as t,v as a,x as o,h as n,y as l,z as s,A as r,B as i,C as c,f as u,D as d,F as v,E as g,w as p,n as m,c as f,a as h,G as y,H as b,o as _,I as C}from"./vendor-D2G894JX.js";import{t as S,p as k}from"./maps-Bv_WW16C.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const w=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a},E={class:"map-container"},L={class:"map-controls"},P=["disabled","title"];const N=w({name:"MapContainer",props:{notes:{type:Array,default:()=>[]}},emits:["coordinates-changed","location-found","location-error","map-event","pin-clicked"],setup(t,{emit:a}){const o=e(null),n=e(!1),l=e(null),s=e(null),r=e([0,0]),i=e(2),c=e("EPSG:3857"),{getCurrentPosition:u}=function(){const t=e("geolocation"in navigator),a=e(!1),o=e(null);return{isSupported:t,isLoading:a,error:o,getCurrentPosition:(e={})=>new Promise((n,l)=>{if(!t.value){const e=new Error("Geolocation is not supported by this browser");return e.code=0,void l(e)}a.value=!0,o.value=null;const s={enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4,...e};navigator.geolocation.getCurrentPosition(e=>{a.value=!1,n(e)},e=>{a.value=!1,o.value=e,l(e)},s)}),watchPosition:(e,a={})=>{if(!t.value){const e=new Error("Geolocation is not supported by this browser");return e.code=0,o.value=e,null}const n={enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4,...a};return navigator.geolocation.watchPosition(t=>{o.value=null,e(t)},t=>{o.value=t,e(null,t)},n)},clearWatch:e=>{e&&t.value&&navigator.geolocation.clearWatch(e)}}}();return r.value=S([-.09,51.505],"EPSG:4326","EPSG:3857"),i.value=13,{view:o,center:r,zoom:i,projection:c,userLocation:s,isLocating:n,locationStatus:l,handleMapMove:e=>{if(o.value){const e=o.value.getCenter(),[t,n]=S(e,"EPSG:3857","EPSG:4326");a("coordinates-changed",{lat:n,lng:t,accuracy:null}),a("map-event",{type:"map_moved",message:`Map moved to ${n.toFixed(6)}, ${t.toFixed(6)}`})}},handleMapClick:e=>{const[t,o]=S(e.coordinate,"EPSG:3857","EPSG:4326");a("map-event",{type:"map_clicked",message:`Map clicked at ${o.toFixed(6)}, ${t.toFixed(6)}`}),a("coordinates-changed",{lat:o,lng:t,accuracy:null})},handlePinClick:e=>{a("pin-clicked",e),a("map-event",{type:"pin_clicked",message:`Clicked ${e.type} note pin`})},locateUser:async()=>{if(!n.value){n.value=!0,l.value={type:"info",message:"Locating..."};try{const e=await u({enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}),{latitude:t,longitude:o,accuracy:n}=e.coords,c=S([o,t],"EPSG:4326","EPSG:3857");r.value=c,i.value=16,s.value=c,l.value={type:"success",message:`Location found (±${Math.round(n)}m accuracy)`},a("location-found",{lat:t,lng:o,accuracy:n}),a("coordinates-changed",{lat:t,lng:o,accuracy:n}),a("map-event",{type:"gps_location",message:`GPS location: ${t.toFixed(6)}, ${o.toFixed(6)}`}),setTimeout(()=>{l.value=null},3e3)}catch(e){let t="Location access denied or unavailable";switch(e.code){case 1:t="Location access denied by user";break;case 2:t="Location unavailable";break;case 3:t="Location request timed out";break;default:t=e.message||"Unknown location error"}l.value={type:"error",message:t},a("location-error",{code:e.code,message:t}),setTimeout(()=>{l.value=null},5e3)}finally{n.value=!1}}},getStatusIcon:e=>{switch(e){case"success":return"fas fa-check-circle";case"error":return"fas fa-exclamation-circle";default:return"fas fa-info-circle"}},transform:S}}},[["render",function(e,p,m,f,h,y){const b=c("ol-view"),_=c("ol-source-osm"),C=c("ol-tile-layer"),S=c("ol-geom-point"),k=c("ol-style-fill"),w=c("ol-style-stroke"),N=c("ol-style-circle"),x=c("ol-style"),$=c("ol-feature"),F=c("ol-source-vector"),I=c("ol-vector-layer"),M=c("ol-style-text"),A=c("ol-map");return u(),t("div",E,[a(A,{loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,style:{height:"100%"},onMoveend:f.handleMapMove,onClick:f.handleMapClick},{default:l(()=>[a(b,{ref:"view",center:f.center,zoom:f.zoom,projection:f.projection},null,8,["center","zoom","projection"]),a(C,null,{default:l(()=>[a(_)]),_:1}),f.userLocation?(u(),d(I,{key:0},{default:l(()=>[a(F,null,{default:l(()=>[a($,null,{default:l(()=>[a(S,{coordinates:f.userLocation},null,8,["coordinates"]),a(x,null,{default:l(()=>[a(N,{radius:8},{default:l(()=>[a(k,{color:"blue"}),a(w,{color:"white",width:2})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):n("",!0),a(I,null,{default:l(()=>[a(F,null,{default:l(()=>[(u(!0),t(v,null,g(m.notes,e=>(u(),d($,{key:e.id,onClick:t=>f.handlePinClick(e)},{default:l(()=>[a(S,{coordinates:f.transform([e.coordinates.lng,e.coordinates.lat],"EPSG:4326","EPSG:3857")},null,8,["coordinates"]),a(x,null,{default:l(()=>[a(N,{radius:12},{default:l(()=>[a(k,{color:"local"===e.type?"#28a745":"#dc3545"},null,8,["color"]),a(w,{color:"white",width:2})]),_:2},1024),a(M,{text:"📍",font:"16px sans-serif"})]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["onMoveend","onClick"]),o("div",L,[o("button",{onClick:p[0]||(p[0]=(...e)=>f.locateUser&&f.locateUser(...e)),class:"btn btn--primary btn--round",disabled:f.isLocating,title:f.isLocating?"Locating...":"Find my location"},[o("i",{class:s(f.isLocating?"fas fa-spinner fa-spin":"fas fa-location-arrow")},null,2)],8,P)]),f.locationStatus?(u(),t("div",{key:0,class:s(["location-status",`location-status--${f.locationStatus.type}`])},[o("i",{class:s(f.getStatusIcon(f.locationStatus.type))},null,2),r(" "+i(f.locationStatus.message),1)],2)):n("",!0)])}]]),x={class:"crosshair"};const $=w({name:"Crosshair"},[["render",function(e,a,n,l,s,r){return u(),t("div",x,a[0]||(a[0]=[o("div",{class:"crosshair__horizontal"},null,-1),o("div",{class:"crosshair__vertical"},null,-1),o("div",{class:"crosshair__center"},null,-1)]))}],["__scopeId","data-v-c2b118c8"]]),F={class:"event-logger"},I={class:"event-logger__header"},M={class:"event-logger__controls"},A={class:"event-logger__content",ref:"logContent"},G={class:"event-logger__item-header"},D={class:"event-logger__item-type"},U={class:"event-logger__item-time"},O={class:"event-logger__item-message"},R={key:0,class:"event-logger__empty"};const T=w({name:"EventLogger",props:{events:{type:Array,required:!0}},emits:["close"],setup(t){const a=e(null);return p(()=>t.events.length,async()=>{await m(),a.value&&(a.value.scrollTop=a.value.scrollHeight)}),{logContent:a,getEventIcon:e=>({gps:"fas fa-location-arrow",coordinates:"fas fa-crosshairs",map:"fas fa-map",ui:"fas fa-mouse-pointer",system:"fas fa-cog",error:"fas fa-exclamation-triangle",map_initialized:"fas fa-map",map_moved:"fas fa-arrows-alt",map_zoomed:"fas fa-search",map_clicked:"fas fa-mouse-pointer"}[e]||"fas fa-circle"),formatTime:e=>new Date(e).toLocaleTimeString()}}},[["render",function(e,a,l,c,d,p){return u(),t("div",F,[o("div",I,[a[2]||(a[2]=o("h3",{class:"event-logger__title"},[o("i",{class:"fas fa-list"}),r(" Event Log ")],-1)),o("div",M,[o("button",{onClick:a[0]||(a[0]=t=>e.$emit("close")),class:"btn btn--small btn--secondary"},a[1]||(a[1]=[o("i",{class:"fas fa-times"},null,-1)]))])]),o("div",A,[(u(!0),t(v,null,g(l.events,e=>(u(),t("div",{key:e.id,class:s(["event-logger__item",`event-logger__item--${e.type}`])},[o("div",G,[o("span",D,[o("i",{class:s(c.getEventIcon(e.type))},null,2),r(" "+i(e.type.toUpperCase()),1)]),o("span",U,i(c.formatTime(e.timestamp)),1)]),o("div",O,i(e.message),1)],2))),128)),0===l.events.length?(u(),t("div",R,a[3]||(a[3]=[o("i",{class:"fas fa-inbox"},null,-1),o("p",null,"No events logged yet",-1)]))):n("",!0)],512)])}],["__scopeId","data-v-91cebd05"]]),j={name:"NotePanel",props:{isVisible:{type:Boolean,default:!1},coordinates:{type:Object,required:!0}},emits:["close","save-note"],setup(t,{emit:a}){const o=e(""),n=e(null),l=e(null),s=e(null),r=e(!1),i=e(!1),c=e(0),u=e(null),d=e([]),v=e(null),g=f(()=>o.value.trim()||n.value||l.value),m=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});u.value=new MediaRecorder(e),d.value=[],u.value.ondataavailable=e=>{d.value.push(e.data)},u.value.onstop=()=>{const t=new Blob(d.value,{type:"audio/wav"});n.value=URL.createObjectURL(t),e.getTracks().forEach(e=>e.stop())},u.value.start(),r.value=!0,c.value=0,v.value=setInterval(()=>{c.value+=1},1e3)}catch(e){console.error("Error accessing microphone:",e),alert("Cannot access microphone. Please check permissions.")}},y=()=>{u.value&&r.value&&(u.value.stop(),r.value=!1,v.value&&(clearInterval(v.value),v.value=null))},b=()=>{o.value="",n.value=null,l.value=null,c.value=0,s.value&&(s.value.value="")};return h(()=>{v.value&&clearInterval(v.value),r.value&&y()}),p(()=>t.isVisible,e=>{e||b()}),{textNote:o,audioUrl:n,photoUrl:l,fileInput:s,isRecording:r,isProcessing:i,recordingDuration:c,hasContent:g,toggleRecording:async()=>{r.value?y():await m()},openCamera:()=>{s.value.setAttribute("capture","environment"),s.value.click()},openGallery:()=>{s.value.removeAttribute("capture"),s.value.click()},handleFileSelect:e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{l.value=e.target.result},e.readAsDataURL(t)}},removePhoto:()=>{l.value=null,s.value.value=""},formatDuration:e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,saveNote:()=>{const e={coordinates:t.coordinates,textNote:o.value,audioUrl:n.value,photoUrl:l.value,timestamp:(new Date).toISOString()};a("save-note",e),b()}}}},z={key:0,class:"note-panel"},B={class:"note-panel__header"},H={class:"note-panel__content"},q={class:"note-section"},V={class:"note-section"},W={class:"audio-controls"},J=["disabled"],K={key:0,class:"recording-duration"},Q=["src"],X={class:"note-section"},Y={class:"photo-controls"},Z={key:0,class:"photo-preview"},ee=["src"],te={class:"note-panel__footer"},ae=["disabled"];const oe=w(j,[["render",function(e,a,l,c,d,v){var g,p;return l.isVisible?(u(),t("div",z,[o("div",B,[o("h3",null,[a[9]||(a[9]=o("i",{class:"fas fa-sticky-note"},null,-1)),r(" New Note at "+i(null==(g=l.coordinates.lat)?void 0:g.toFixed(6))+", "+i(null==(p=l.coordinates.lng)?void 0:p.toFixed(6)),1)]),o("button",{onClick:a[0]||(a[0]=t=>e.$emit("close")),class:"btn btn--small btn--secondary"},a[10]||(a[10]=[o("i",{class:"fas fa-times"},null,-1)]))]),o("div",H,[o("div",q,[a[11]||(a[11]=o("label",{class:"note-label"},[o("i",{class:"fas fa-edit"}),r(" Text Note ")],-1)),y(o("textarea",{"onUpdate:modelValue":a[1]||(a[1]=e=>c.textNote=e),placeholder:"Enter your note here...",class:"note-textarea",rows:"4"},null,512),[[b,c.textNote]])]),o("div",V,[a[12]||(a[12]=o("label",{class:"note-label"},[o("i",{class:"fas fa-microphone"}),r(" Audio Recording ")],-1)),o("div",W,[o("button",{onClick:a[2]||(a[2]=(...e)=>c.toggleRecording&&c.toggleRecording(...e)),class:s(["btn",c.isRecording?"btn--danger":"btn--primary"]),disabled:c.isProcessing},[o("i",{class:s(c.isRecording?"fas fa-stop":"fas fa-microphone")},null,2),r(" "+i(c.isRecording?"Stop Recording":"Start Recording"),1)],10,J),c.recordingDuration>0?(u(),t("span",K,i(c.formatDuration(c.recordingDuration)),1)):n("",!0)]),c.audioUrl?(u(),t("audio",{key:0,src:c.audioUrl,controls:"",class:"audio-player"},null,8,Q)):n("",!0)]),o("div",X,[a[16]||(a[16]=o("label",{class:"note-label"},[o("i",{class:"fas fa-camera"}),r(" Photo ")],-1)),o("div",Y,[o("input",{ref:"fileInput",type:"file",accept:"image/*",capture:"environment",onChange:a[3]||(a[3]=(...e)=>c.handleFileSelect&&c.handleFileSelect(...e)),style:{display:"none"}},null,544),o("button",{onClick:a[4]||(a[4]=(...e)=>c.openCamera&&c.openCamera(...e)),class:"btn btn--primary"},a[13]||(a[13]=[o("i",{class:"fas fa-camera"},null,-1),r(" Take Photo ")])),o("button",{onClick:a[5]||(a[5]=(...e)=>c.openGallery&&c.openGallery(...e)),class:"btn btn--secondary"},a[14]||(a[14]=[o("i",{class:"fas fa-images"},null,-1),r(" From Gallery ")]))]),c.photoUrl?(u(),t("div",Z,[o("img",{src:c.photoUrl,alt:"Note photo",class:"preview-image"},null,8,ee),o("button",{onClick:a[6]||(a[6]=(...e)=>c.removePhoto&&c.removePhoto(...e)),class:"btn btn--small btn--danger remove-photo"},a[15]||(a[15]=[o("i",{class:"fas fa-trash"},null,-1)]))])):n("",!0)])]),o("div",te,[o("button",{onClick:a[7]||(a[7]=(...e)=>c.saveNote&&c.saveNote(...e)),class:"btn btn--primary",disabled:!c.hasContent||c.isProcessing},a[17]||(a[17]=[o("i",{class:"fas fa-save"},null,-1),r(" Save Note ")]),8,ae),o("button",{onClick:a[8]||(a[8]=t=>e.$emit("close")),class:"btn btn--secondary"}," Cancel ")])])):n("",!0)}],["__scopeId","data-v-be86fcd3"]]);const ne=e([]),le=e([]);const se={class:"app"},re={class:"header"},ie={class:"header__controls"},ce=["disabled"],ue={class:"main"},de={class:"map-section"};const ve=C(w({name:"App",components:{MapContainer:N,Crosshair:$,EventLogger:T,NotePanel:oe},setup(){const t=e(!1),a=e(!1),o=e({lat:null,lng:null,accuracy:null}),{events:n,logEvent:l}=function(){const t=e([]),a=(e,a,o={})=>{const n={id:Date.now()+Math.random().toString(36).substr(2,9),type:e,message:a,timestamp:Date.now(),...o};t.value.push(n),t.value.length>100&&(t.value=t.value.slice(-100)),console.log(`[${e.toUpperCase()}] ${a}`,o)};return{events:t,logEvent:a,clearEvents:()=>{t.value=[],a("system","Event log cleared")},getEventsByType:e=>t.value.filter(t=>t.type===e),getEventsInTimeRange:(e,a)=>t.value.filter(t=>t.timestamp>=e&&t.timestamp<=a),exportEvents:()=>{const e={exportDate:(new Date).toISOString(),totalEvents:t.value.length,events:t.value};return JSON.stringify(e,null,2)}}}(),{localNotes:s,serverNotes:r,saveLocalNote:i}=function(){const e=()=>{try{const e=localStorage.getItem("osm-notes-local");e&&(ne.value=JSON.parse(e))}catch(e){console.error("Error loading notes from localStorage:",e)}},t=()=>{try{localStorage.setItem("osm-notes-local",JSON.stringify(ne.value))}catch(e){console.error("Error saving notes to localStorage:",e)}},a=()=>"note_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);return e(),{localNotes:ne,serverNotes:le,saveLocalNote:e=>{const o={id:a(),...e,type:"local",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};return ne.value.push(o),t(),o},deleteLocalNote:e=>{const a=ne.value.findIndex(t=>t.id===e);-1!==a&&(ne.value.splice(a,1),t())},updateLocalNote:(e,a)=>{const o=ne.value.find(t=>t.id===e);o&&(Object.assign(o,a,{updatedAt:(new Date).toISOString()}),t())},getNotesInBounds:e=>[...ne.value,...le.value].filter(t=>{const a=t.coordinates.lat,o=t.coordinates.lng;return a>=e.south&&a<=e.north&&o>=e.west&&o<=e.east}),loadFromLocalStorage:e,saveToLocalStorage:t}}(),c=f(()=>[...s.value,...r.value]);return _(()=>{l("system","Application initialized with note-taking capabilities")}),{showEventLogger:t,showNotePanel:a,currentCoordinates:o,allNotes:c,events:n,toggleEventLogger:()=>{t.value=!t.value,l("ui","Event logger "+(t.value?"opened":"closed"))},openNotePanel:()=>{o.value.lat&&(a.value=!0,l("ui",`Note panel opened for coordinates ${o.value.lat.toFixed(6)}, ${o.value.lng.toFixed(6)}`))},handleCoordinatesChanged:e=>{o.value=e,l("coordinates",`Crosshair positioned at ${e.lat.toFixed(6)}, ${e.lng.toFixed(6)}`)},handleLocationFound:e=>{l("gps",`GPS location found: ${e.lat.toFixed(6)}, ${e.lng.toFixed(6)} (accuracy: ${e.accuracy}m)`)},handleLocationError:e=>{l("error",`GPS error: ${e.message}`)},handleSaveNote:e=>{const t=i(e);a.value=!1,l("note",`Local note saved with ID: ${t.id}`)},handlePinClick:e=>{l("ui",`Clicked on ${e.type} note pin: ${e.id}`)},logEvent:l}}},[["render",function(e,l,i,v,g,p){const m=c("MapContainer"),f=c("Crosshair"),h=c("NotePanel"),y=c("EventLogger");return u(),t("div",se,[o("header",re,[l[6]||(l[6]=o("h1",{class:"header__title"},[o("i",{class:"fas fa-crosshairs"}),r(" OSM Notes v0.1.2 ")],-1)),o("div",ie,[o("button",{onClick:l[0]||(l[0]=(...e)=>v.openNotePanel&&v.openNotePanel(...e)),class:"btn btn--primary",title:"Add note at current coordinates",disabled:!v.currentCoordinates.lat},l[4]||(l[4]=[o("i",{class:"fas fa-sticky-note"},null,-1),o("span",{class:"btn__text"},"Add Note",-1)]),8,ce),o("button",{onClick:l[1]||(l[1]=(...e)=>v.toggleEventLogger&&v.toggleEventLogger(...e)),class:s(["btn btn--secondary",{"btn--active":v.showEventLogger}])},l[5]||(l[5]=[o("i",{class:"fas fa-list"},null,-1),o("span",{class:"btn__text"},"Events",-1)]),2)])]),o("main",ue,[o("div",de,[a(m,{notes:v.allNotes,onCoordinatesChanged:v.handleCoordinatesChanged,onLocationFound:v.handleLocationFound,onLocationError:v.handleLocationError,onMapEvent:v.logEvent,onPinClicked:v.handlePinClick},null,8,["notes","onCoordinatesChanged","onLocationFound","onLocationError","onMapEvent","onPinClicked"]),a(f)]),a(h,{"is-visible":v.showNotePanel,coordinates:v.currentCoordinates,onClose:l[2]||(l[2]=e=>v.showNotePanel=!1),onSaveNote:v.handleSaveNote},null,8,["is-visible","coordinates","onSaveNote"]),v.showEventLogger?(u(),d(y,{key:0,events:v.events,onClose:l[3]||(l[3]=e=>v.showEventLogger=!1)},null,8,["events"])):n("",!0)])])}]]));ve.use(k),ve.mount("#app");
